proxy-providers:
    ProviderALL:
        url: https://cdplus.netlify.app/dw/speed.yaml
        type: http
        interval: 600
        proxy: DIRECT
        path: ./proxy_provider/ALL.yaml

port: 7890
socks-port: 7891
mixed-port: 10801
redir-port: 7892
tproxy-port: 7893
allow-lan: true
bind-address: "*"
find-process-mode: strict
mode: rule
geox-url:
    geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
    geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
    mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb"
geo-auto-update: true
geo-update-interval: 24
log-level: silent
ipv6: false
external-controller: 0.0.0.0:9090 # 
external-controller-tls: 0.0.0.0:9443
external-controller-unix: mihomo.sock
external-controller-pipe: \\.\pipe\mihomo
external-ui: ui
external-ui-url: "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip"
external-doh-server: /dns-query
global-client-fingerprint: chrome
hosts:
# '*.mihomo.dev': 127.0.0.1
# '.dev': 127.0.0.1
# 'alpha.mihomo.dev': '::1'
# test.com: [1.1.1.1, 2.2.2.2]
# home.lan: lan # lan 为特别字段，将加入本地所有网卡的地址
# baidu.com: google.com # 只允许配置一个别名
profile:
    store-selected: false
    store-fake-ip: true
### 域名嗅探
sniffer:
    enable: true
    sniff:
        HTTP:
            ports: [80, 8080-8880]
            override-destination: true
        TLS:
            ports: [443, 8443]
        QUIC:
            ports: [443, 8443]
    skip-domain:
        - "Mijia Cloud"
        - "+.push.apple.com"
tun:
    enable: true
    stack: system
    auto-route: true
    auto-redirect: true
    auto-detect-interface: true
    dns-hijack:
        - any:53
        - tcp://any:53
    device: mihomo
    mtu: 9000
    strict-route: false
    gso: true
    gso-max-size: 65536
    udp-timeout: 300
    iproute2-table-index: 2022
    iproute2-rule-index: 9000
    endpoint-independent-nat: false
    route-exclude-address:
        - 172.16.0.0/12
        - fc00::/7
dns:
    enable: true
    listen: 0.0.0.0:53
    ipv6: false
    default-nameserver: [223.5.5.5, 119.29.29.29]
    enhanced-mode: fake-ip
    fake-ip-range: 198.18.0.1/16
    use-hosts: true
    nameserver: ['https://doh.pub/dns-query', 'https://dns.alidns.com/dns-query']
    url-test: ['https://doh.dns.sb/dns-query', 'https://dns.cloudflare.com/dns-query', 'https://dns.twnic.tw/dns-query', 'tls://8.8.4.4:853']
    url-test-filter: {geoip: true, ipcidr: [240.0.0.0/4, 0.0.0.0/32]}
proxy-groups:
    - name: Proxy
      type: select
      interval: 300
      url: https://gstatic.com/generate_204
      lazy: true
      timeout: 2000
      max-failed-times: 3
      proxies:
        - "\U0001F64F 自动选择"
        - "\U0001F3A1负载均衡"
        - "\U0001F4AA 手动选择"
        - "\U0001F1ED\U0001F1F0 香港节点"
        - "\U0001F1EF\U0001F1F5 日本节点"
        - "\U0001F1F0\U0001F1F7 韩国节点"
        - "\U0001F1F8\U0001F1EC 新加坡节点"
        - "\U0001F1FA\U0001F1F8 美国节点" 
      icon: https://cdn.jsdelivr.net/gh/mihomo-party-org/mihomo-party/resources/icon.png
    - name: youtube
      type: select
      interval: 300
      url: https://gstatic.com/generate_204
      lazy: true
      timeout: 2000
      max-failed-times: 3
      proxies:
        - "\U0001F64F 自动选择"
        - "\U0001F3A1负载均衡"
        - "\U0001F4AA 手动选择"
        - "\U0001F1ED\U0001F1F0 香港节点"
        - "\U0001F1EF\U0001F1F5 日本节点"
        - "\U0001F1FA\U0001F1F8 美国节点"
        - "\U0001F1F8\U0001F1EC 新加坡节点"
      icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/cloudflare.png
    - name: Cloudflare
      type: select
      interval: 300
      url: https://gstatic.com/generate_204
      lazy: true
      timeout: 2000
      max-failed-times: 3
      proxies:
        - DIRECT
        - "\U0001F1ED\U0001F1F0 香港节点"
        - "\U0001F1EF\U0001F1F5 日本节点"
        - "\U0001F1F0\U0001F1F7 韩国节点"
        - "\U0001F1F8\U0001F1EC 新加坡节点"
        - "\U0001F1FA\U0001F1F8 美国节点"
        - Proxy
      icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/cloudflare.png
    - name: "\U0001F4AA 手动选择"
      type: select
      use:
        - ProviderALL
    - name: "\U0001F64F 自动选择"
      type: url-test
      tolerance: 100
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      use:
        - ProviderALL
    - name: "\U0001F3A1负载均衡"
      type: load-balance
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      strategy: sticky-sessions
      use:
        - ProviderALL
    - name: "\U0001F1ED\U0001F1F0 香港节点"
      type: url-test
      tolerance: 100
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      filter: "^(?=.*((?i)\U0001F1ED\U0001F1F0|香港|(\\b(HK|Hong)\\b))).*$"
      use:
        - ProviderALL
    - name: "\U0001F1EF\U0001F1F5 日本节点"
      type: url-test
      tolerance: 100
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      filter: "^(?=.*((?i)\U0001F1EF\U0001F1F5|日本|川日|东京|大阪|泉日|埼玉|(\\b(JP|Japan)\\b))).*$"
      use:
        - ProviderALL
    - name: "\U0001F1F0\U0001F1F7 韩国节点"
      type: url-test
      tolerance: 100
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      filter: "^(?=.*((?i)\U0001F1F0\U0001F1F7|韩国|韓|首尔|(\\b(KR|Korea)\\b))).*$"
      use:
        - ProviderALL
    - name: "\U0001F1F8\U0001F1EC 新加坡节点"
      type: url-test
      tolerance: 100
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      filter: "^(?=.*((?i)\U0001F1F8\U0001F1EC|新加坡|狮|(\\b(SG|Singapore)\\b))).*$"
      use:
        - ProviderALL
    - name: "\U0001F1FA\U0001F1F8 美国节点"
      type: url-test
      tolerance: 100
      interval: 60
      lazy: true
      url: https://gstatic.com/generate_204
      disable-udp: false
      timeout: 2000
      max-failed-times: 3
      filter: "^(?=.*((?i)\U0001F1FA\U0001F1F8|美国|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|(\\b(US|United States)\\b))).*$"
      use:
        - ProviderALL
rule-providers:
    GlobalMedia:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GlobalMedia/GlobalMedia_Classical.yaml
        path: ./RuleSet/GlobalMedia.yaml
    ChinaMedia:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaMedia/ChinaMedia.yaml
        path: ./RuleSet/ChinaMedia.yaml
    Proxy:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Proxy/Proxy_Classical_No_Resolve.yaml
        path: ./RuleSet/Proxy.yaml
    China:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaMax/ChinaMax_Classical.yaml
        path: ./RuleSet/China.yaml
    Tencent:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Tencent/Tencent.yaml
        path: ./RuleSet/Tencent.yaml
    LAN:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Lan/Lan.yaml
        path: ./RuleSet/LAN.yaml
    Onedrive:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OneDrive/OneDrive.yaml
        path: ./RuleSet/Onedrive.yaml
    Apple:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Apple/Apple_Classical_No_Resolve.yaml
        path: ./RuleSet/Apple.yaml
    Microsoft:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Microsoft/Microsoft_No_Resolve.yaml
        path: ./RuleSet/Microsoft.yaml
    YouTube:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTube/YouTube_No_Resolve.yaml
        path: ./RuleSet/YouTube.yaml
    Cloudflare:
        type: http
        behavior: classical
        interval: 86400
        format: yaml
        proxy: DIRECT
        url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Cloudflare/Cloudflare.yaml
        path: ./RuleSet/Cloudflare.yaml
rules:
    - RULE-SET,ChinaMedia,DIRECT
    - RULE-SET,China,DIRECT
    - RULE-SET,LAN,DIRECT
    - DOMAIN-KEYWORD,4d4y,DIRECT
    - DOMAIN-KEYWORD,linux.do,DIRECT
    - DOMAIN-KEYWORD,dynv6,DIRECT
    - GEOIP,CN,DIRECT
    - RULE-SET,Cloudflare,Cloudflare
    - RULE-SET,Onedrive,DIRECT
    - RULE-SET,Apple,DIRECT
    - RULE-SET,YouTube,youtube
    - RULE-SET,Microsoft,DIRECT
    - RULE-SET,GlobalMedia,Proxy
    - RULE-SET,Proxy,Proxy
    - MATCH,Proxy
secret: ""
unified-delay: false
tcp-concurrent: true
geodata-mode: false
skip-auth-prefixes:
    - 127.0.0.1/32
authentication: []
lan-allowed-ips:
    - 0.0.0.0/0
    - ::/0
lan-disallowed-ips: []
